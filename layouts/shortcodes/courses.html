{{ range .Site.Data.courses.courseCategories }}
  {{ $categoryId := .id }}
  {{ $categoryTitle := .title }}
  {{ $categoryIcon := .icon }}
  {{ $categoryAccent := .accent }}
  {{ $coursesInCategory := where $.Site.Data.courses.courses "category" $categoryId }}
  
<div class="course-category courses-left-align" data-accent="{{ $categoryAccent }}" data-category="{{ $categoryId }}">
  <h2 class="category-title">{{ $categoryIcon }} {{ $categoryTitle }}</h2>
  <div class="course-grid{{ if eq $categoryId "research" }} research{{ end }}">
    {{ range $coursesInCategory }}
    {{ $fieldInfo := (index (where $.Site.Data.courses.courseFields "id" .field) 0) }}
    <div class="course-card" data-category="{{ $categoryId }}" data-field="{{ .field }}">
      {{ if .new }}
      <div class="course-new-ribbon" style="background-color: {{ $fieldInfo.color }}">
        <span class="ribbon-text">New</span>
      </div>
      {{ end }}
      <h3>{{ .title }}</h3>
      <p>{{ .description }}</p>
      <div class="course-field-stripe" style="background-color: {{ $fieldInfo.color }}">
        <span class="field-name">{{ $fieldInfo.title }}</span>
      </div>
    </div>
    {{ end }}
  </div>
</div>
{{ end }}