{{ range .Site.Data.courses.courseLevels }}
  {{ $levelId := .id }}
  {{ $levelTitle := .title }}
  {{ $levelIcon := .icon }}
  {{ $levelAccent := .accent }}
  {{ $coursesInLevel := where $.Site.Data.courses.courses "level" $levelId }}
  
<div class="course-level courses-left-align" data-accent="{{ $levelAccent }}" data-level="{{ $levelId }}">
  <h2 class="level-title">{{ $levelIcon }} {{ $levelTitle }}</h2>
  <div class="course-grid{{ if eq $levelId "research" }} research{{ end }}">
    {{ range $coursesInLevel }}
    {{ $fieldInfo := (index (where $.Site.Data.courses.courseFields "id" .field) 0) }}
    <div class="course-card" data-level="{{ $levelId }}" data-field="{{ .field }}">
      {{ if .new }}
      <div class="course-new-ribbon" style="background-color: {{ $fieldInfo.color }}">
        <span class="ribbon-text">New</span>
      </div>
      {{ end }}
      <h3>{{ .title }}</h3>
      <p>{{ .description }}</p>
      {{ if or .shortcode .duration .price }}
      <div class="course-meta">
        {{ if .shortcode }}<span class="course-shortcode">{{ .shortcode }}</span>{{ end }}
        {{ if .duration }}<span class="course-duration">{{ .duration }}w</span>{{ end }}
        {{ if .price }}<span class="course-price">${{ .price }}/pp</span>{{ end }}
      </div>
      {{ end }}
      <div class="course-field-stripe" style="background-color: {{ $fieldInfo.color }}">
        <span class="field-name">{{ $fieldInfo.title }}</span>
      </div>
    </div>
    {{ end }}
  </div>
</div>
{{ end }}